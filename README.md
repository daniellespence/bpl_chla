# bpl_chla
R code used for statistical analyses and plots in *Climate variability and flow management impact phytoplankton biomass in a shallow reservoir* (Spence, Painter, Nazemi, Venkiteswaran, Baulch, 2025)

author: "Danielle Spence"

date: "October 2025"

output:
  pdf_document: default
  html_document: default
  
---

Overview
--------

The code in this replication package uses R to construct all analyses in *Climate, flow source, and nutrients impact phytoplankton biomass in a hydrologically managed, shallow drinking water reservoir*. Here, one master file runs all of the code to generate the data for 2 tables and 3 figures in the paper. Scripts for data analysis are available at https://github.com/daniellespence/bpl_chla

Data Availability and Provenance Statements
----------------------------

- [ ] This paper does not involve analysis of external data (i.e., no data are used or the only data are generated by the authors via simulation in their code).

### Statement about Rights

- [x] I certify that the author(s) of the manuscript have legitimate access to and permission to use the data used in this manuscript. 


### License for Data

Licence: Open Government Licence - Canada

### Summary of Availability

- [ ] All data **are** publicly available.
- [x] Some data **cannot be made** publicly available.
- [ ] **No data can be made** publicly available.

### Details on each Data Source

Data were provided by the Buffalo Pound Water Treatment Plant.

Data were prepared using scripts I—III available at https://github.com/daniellespence/bpl_chla/tree/main/Code

Datafile used:  `bpgamdataCLEAN_flow.csv`

Computational requirements
---------------------------

### Software Requirements

- R 3.6.3
  - `pacman`
  - `tidyverse`
  - `mgcv`
  - `gratia`
  - `dplyr`
  - `ggplot2`
  - `cowplot`


### Memory and Runtime Requirements

#### Summary

Approximate time needed to reproduce the analyses on a standard (2020) desktop machine:

- [ ] <10 minutes
- [x] 10-60 minutes
- [ ] 1-8 hours
- [ ] 8-24 hours
- [ ] 1-3 days
- [ ] 3-14 days
- [ ] > 14 days
- [ ] Not feasible to run on a desktop machine, as described below.

#### Details

The code was run on a **7-core Intel-based desktop with 32 GB of RAM and a Windows 10 operating system**. 

Description of programs/code
----------------------------

Data preparation and GAM analysis scripts are available at https://github.com/daniellespence/bpl_chla
The code is licensed under a MIT/BSD/GPL/Creative Commons license.

Instructions to Replicators
---------------------------

- You will need to install the following R packages

`install.packages("pacman", "tidyverse", "mgcv", "gratia", "dplyr", "ggplot2", "cowplot")`

- Prepare the data using scripts i–iii.
- Run the `iv. Chla GAM fitting.R` R script to select the best fit model
- Run the `1. Chla time series.R` and `2. Chla GAM predictors.R` R scripts to generate model outputs, as well as to create and save plots
- Run the `Plotting annual totals all predictors chla.R` R script to generate timeline figure and the water temperature plot

List of tables and programs
---------------------------

The provided code reproduces:

- [x] All numbers provided in text in the paper
- [ ] All tables and figures in the paper
- [x] Selected tables and figures in the paper, as explained and justified below.


| Figure/Table  | Code/Program             | Line Number | Output file                      | Note   |
|-----------|-------------------------|-------------|----------------------------------|-------|
| Figure 1 | `1. Chla time series.R` |      |   ||
| Figure 2 |  `1. Chla time series.R`|      |   ||
| Figure 3 | `2. Chla GAM predictors.R` |      |   ||
| Figure S1 |  `QLD vs. QWs.R` |     |   ||
| Figure S2 | `Plotting annual totals all predictors chla.R` |      |   ||
| Figure S3 | `2. Chla GAM predictors.R`|       |   ||
| Figure S4 | `Plotting annual totals all predictors chla.R`|      |   ||
